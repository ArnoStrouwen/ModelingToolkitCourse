<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Lecture 1: Introduction to acausal modeling for physical systems with ModelingToolkit.jl · ModelingToolkit Course</title><meta name="title" content="Lecture 1: Introduction to acausal modeling for physical systems with ModelingToolkit.jl · ModelingToolkit Course"/><meta property="og:title" content="Lecture 1: Introduction to acausal modeling for physical systems with ModelingToolkit.jl · ModelingToolkit Course"/><meta property="twitter:title" content="Lecture 1: Introduction to acausal modeling for physical systems with ModelingToolkit.jl · ModelingToolkit Course"/><meta name="description" content="Documentation for ModelingToolkit Course."/><meta property="og:description" content="Documentation for ModelingToolkit Course."/><meta property="twitter:description" content="Documentation for ModelingToolkit Course."/><meta property="og:url" content="https://docs.sciml.ai/ModelingToolkitCourse/stable/lectures/lecture1/"/><meta property="twitter:url" content="https://docs.sciml.ai/ModelingToolkitCourse/stable/lectures/lecture1/"/><link rel="canonical" href="https://docs.sciml.ai/ModelingToolkitCourse/stable/lectures/lecture1/"/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script><link href="../../assets/favicon.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">ModelingToolkit Course</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li class="is-active"><a class="tocitem" href>Lecture 1: Introduction to acausal modeling for physical systems with ModelingToolkit.jl</a><ul class="internal"><li><a class="tocitem" href="#Background"><span>Background</span></a></li><li><a class="tocitem" href="#Acausal-Component-Based-Modeling"><span>Acausal - Component Based Modeling</span></a></li></ul></li><li><a class="tocitem" href="../lecture2/">Lecture 2: Developing high-fidelity models of hydraulic systems</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Lecture 1: Introduction to acausal modeling for physical systems with ModelingToolkit.jl</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Lecture 1: Introduction to acausal modeling for physical systems with ModelingToolkit.jl</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/SciML/ModelingToolkitCourse" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/SciML/ModelingToolkitCourse/blob/main/docs/src/lectures/lecture1.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Lecture-1:-Introduction-to-acausal-modeling-for-physical-systems-with-ModelingToolkit.jl"><a class="docs-heading-anchor" href="#Lecture-1:-Introduction-to-acausal-modeling-for-physical-systems-with-ModelingToolkit.jl">Lecture 1: Introduction to acausal modeling for physical systems with ModelingToolkit.jl</a><a id="Lecture-1:-Introduction-to-acausal-modeling-for-physical-systems-with-ModelingToolkit.jl-1"></a><a class="docs-heading-anchor-permalink" href="#Lecture-1:-Introduction-to-acausal-modeling-for-physical-systems-with-ModelingToolkit.jl" title="Permalink"></a></h1><h2 id="Background"><a class="docs-heading-anchor" href="#Background">Background</a><a id="Background-1"></a><a class="docs-heading-anchor-permalink" href="#Background" title="Permalink"></a></h2><h3 id="Julia"><a class="docs-heading-anchor" href="#Julia">Julia</a><a id="Julia-1"></a><a class="docs-heading-anchor-permalink" href="#Julia" title="Permalink"></a></h3><p>This course will use Julia as the fundamental tool to solve numerical problems.  ModelingToolkit.jl is a package writen in pure Julia and leverages the fundamental technologies of symbolic math from Symbolics.jl, numerical solvers from DifferentialEquations.jl, and automatic differentiation from ForwardDiff.jl.  To demonstrate an introduction to these technologeies, lets focus on one of the most fundamental engineering problems: the mass-spring-damper.  For now, let&#39;s leave the mass out of the system to avoid the 2nd derivative term</p><p><img src="../../img/spring_damper.svg" alt/></p><p>This system can be represented by the ordinary differential equation (ODE):</p><p class="math-container">\[d*\dot{x} + k*x = F\]</p><p>To solve this in Julia we can apply finite differencing <span>$\dot{x}_i = \frac{x_i - x_{i-1}}{\Delta t}$</span> and <a href="https://en.wikipedia.org/wiki/Newton%27s_method">Newton&#39;s method</a>.  Here we solve for the first time step...</p><pre><code class="language-julia hljs">using ForwardDiff
using Plots

d=1
k=1000
Δt=1e-3
F = 100

function f(xᵢ, xᵢ₋₁)

    ẋᵢ = (xᵢ - xᵢ₋₁)/Δt
    lhs = d*ẋᵢ + k*xᵢ^1.5
    rhs = F

    return lhs - rhs
end

# Newton&#39;s Method
# first time step (i=2)
xᵢ₋₁ = 0.0
xᵢ = xᵢ₋₁ #&lt;-- guess
g(xᵢ) = f(xᵢ, xᵢ₋₁)
xᵢ -= g(xᵢ)/ForwardDiff.derivative(g, xᵢ)
xᵢ -= g(xᵢ)/ForwardDiff.derivative(g, xᵢ)
xᵢ -= g(xᵢ)/ForwardDiff.derivative(g, xᵢ)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">0.07815220490620071</code></pre><p>Note that we can get the derivative for <code>f</code> from automatic differentiation using <code>ForwardDiff.derivative</code> (or using <code>ForwardDiff.jacobian</code> for a system of equations).  To solve for a series of time steps, we can simply update <code>x</code> and run again for each time step <code>Δt</code>.  </p><pre><code class="language-julia hljs">tol = 1e-3
x = zeros(10)
for i=2:10
    g(xᵢ) = f(xᵢ, x[i-1])
    Δx = Inf
    while abs(Δx) &gt; tol
        Δx = g(x[i])/ForwardDiff.derivative(g, x[i])
        x[i] -= Δx
    end
end

plot(x; ylabel=&quot;x [m]&quot;, xlabel=&quot;time step&quot;)</code></pre><img src="24eeb520.svg" alt="Example block output"/><h3 id="DifferentialEquations.jl"><a class="docs-heading-anchor" href="#DifferentialEquations.jl">DifferentialEquations.jl</a><a id="DifferentialEquations.jl-1"></a><a class="docs-heading-anchor-permalink" href="#DifferentialEquations.jl" title="Permalink"></a></h3><p>For this simple problem it&#39;s easy enough to implement the Newton method and solve directly, however it&#39;s possible to instead use the solvers from DifferentialEquations.jl.  To do this, we simply need to defined a <code>NonlinearProblem</code> by supplying the function <code>f</code> of the form <span>$f(u,p)$</span> where:</p><ul><li><p class="math-container">\[u\]</p>is the variable (scalar or vector)</li><li><p class="math-container">\[p\]</p>is the parameters (scalar or vector)</li></ul><p>In this case <span>$u$</span> and <span>$p$</span> corespond to <code>xᵢ</code> and <code>xᵢ₋₁</code>, respectfully.  This is refered to as the &quot;out-of-place&quot; form, where each call to <code>f</code> allocates, it is also possible to define <span>$f(du,u,p)$</span> in &quot;in-place&quot; form that gives <span>$du$</span> as a pre-allocated memory space to mutate.  </p><p>Then we can solve by specifying the method, in this case we specify <code>NewtonRaphson</code> to implement the same algorithm.</p><pre><code class="language-julia hljs">using DifferentialEquations

prob = NonlinearProblem(f, 0.0, 0.0)
sol=solve(prob, NewtonRaphson(); abstol=tol)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">retcode: Success
u: 0.07815220490620071</code></pre><p>Note:  we get exactly the same result for the first time step.</p><p>TODO: now show how to use <code>remake</code> to solve for a series of time steps.</p><h3 id="Symbolics.jl"><a class="docs-heading-anchor" href="#Symbolics.jl">Symbolics.jl</a><a id="Symbolics.jl-1"></a><a class="docs-heading-anchor-permalink" href="#Symbolics.jl" title="Permalink"></a></h3><ul><li>Use Symbolics to build the function</li><li>introduce @variables</li></ul><h3 id="ModelingToolkit.jl"><a class="docs-heading-anchor" href="#ModelingToolkit.jl">ModelingToolkit.jl</a><a id="ModelingToolkit.jl-1"></a><a class="docs-heading-anchor-permalink" href="#ModelingToolkit.jl" title="Permalink"></a></h3><h4 id="Solving-a-system-of-equations-(NonlinearSystem)"><a class="docs-heading-anchor" href="#Solving-a-system-of-equations-(NonlinearSystem)">Solving a system of equations (<code>NonlinearSystem</code>)</a><a id="Solving-a-system-of-equations-(NonlinearSystem)-1"></a><a class="docs-heading-anchor-permalink" href="#Solving-a-system-of-equations-(NonlinearSystem)" title="Permalink"></a></h4><ul><li>Use ModelingToolkit to solve the problem</li><li>introduce @parameters</li><li>show the f function</li><li>show the jacobian</li><li>introduce <code>equations</code>, <code>defaults</code>, and how to setup initial conditions and parameters</li></ul><h4 id="Using-structural_simplify()"><a class="docs-heading-anchor" href="#Using-structural_simplify()">Using <code>structural_simplify()</code></a><a id="Using-structural_simplify()-1"></a><a class="docs-heading-anchor-permalink" href="#Using-structural_simplify()" title="Permalink"></a></h4><ul><li>demonstrate the problem simplificaiton</li></ul><h4 id="[Practice-Problem]"><a class="docs-heading-anchor" href="#[Practice-Problem]">[Practice Problem]</a><a id="[Practice-Problem]-1"></a><a class="docs-heading-anchor-permalink" href="#[Practice-Problem]" title="Permalink"></a></h4><ul><li>introduce remake</li><li>plot a solution set (do something that errors once the initial conditions are not defaulted correctly)</li></ul><h4 id="Introducing-Time:-ODE&#39;s,-DAE&#39;s-(ODESystem)"><a class="docs-heading-anchor" href="#Introducing-Time:-ODE&#39;s,-DAE&#39;s-(ODESystem)">Introducing Time: ODE&#39;s, DAE&#39;s (<code>ODESystem</code>)</a><a id="Introducing-Time:-ODE&#39;s,-DAE&#39;s-(ODESystem)-1"></a><a class="docs-heading-anchor-permalink" href="#Introducing-Time:-ODE&#39;s,-DAE&#39;s-(ODESystem)" title="Permalink"></a></h4><ul><li>explain Differential</li><li>explain Mass Matrix</li></ul><h2 id="Acausal-Component-Based-Modeling"><a class="docs-heading-anchor" href="#Acausal-Component-Based-Modeling">Acausal - Component Based Modeling</a><a id="Acausal-Component-Based-Modeling-1"></a><a class="docs-heading-anchor-permalink" href="#Acausal-Component-Based-Modeling" title="Permalink"></a></h2><h3 id="Connections"><a class="docs-heading-anchor" href="#Connections">Connections</a><a id="Connections-1"></a><a class="docs-heading-anchor-permalink" href="#Connections" title="Permalink"></a></h3><ul><li>demonstrate the theory of connections</li><li>TODO: reference to where nodal network modeling originated?</li><li>thru variables sum</li><li>accross variables are equal</li><li>Question: does the across variable have to be velocity?  Could it be any other derivative?</li></ul><h3 id="Components"><a class="docs-heading-anchor" href="#Components">Components</a><a id="Components-1"></a><a class="docs-heading-anchor-permalink" href="#Components" title="Permalink"></a></h3><ul><li>demonstrate how components are defined</li><li>best practices</li></ul><h3 id="[Practice-Problem]-2"><a class="docs-heading-anchor" href="#[Practice-Problem]-2">[Practice Problem]</a><a class="docs-heading-anchor-permalink" href="#[Practice-Problem]-2" title="Permalink"></a></h3><ul><li>solve the simple 2 component systems shown in connections help page</li></ul><h3 id="Systems-and-Sub-Systems"><a class="docs-heading-anchor" href="#Systems-and-Sub-Systems">Systems and Sub-Systems</a><a id="Systems-and-Sub-Systems-1"></a><a class="docs-heading-anchor-permalink" href="#Systems-and-Sub-Systems" title="Permalink"></a></h3><ul><li>how to expose ports and create hierarchy</li></ul></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../">« Home</a><a class="docs-footer-nextpage" href="../lecture2/">Lecture 2: Developing high-fidelity models of hydraulic systems »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="auto">Automatic (OS)</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.2.1 on <span class="colophon-date" title="Tuesday 26 December 2023 15:48">Tuesday 26 December 2023</span>. Using Julia version 1.9.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
